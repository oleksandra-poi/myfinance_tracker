{% extends 'financetracker/base.html' %}

{% block content %}
<div class="card">
    <h2 style="margin-top: 0;">Monthly Analytics</h2>
    <p style="color: var(--text-muted);">
    Period:
    {% if selected_month == 1 %}January{% elif selected_month == 2 %}February{% elif selected_month == 3 %}March{% elif selected_month == 4 %}April{% elif selected_month == 5 %}May{% elif selected_month == 6 %}June{% elif selected_month == 7 %}July{% elif selected_month == 8 %}August{% elif selected_month == 9 %}September{% elif selected_month == 10 %}October{% elif selected_month == 11 %}November{% elif selected_month == 12 %}December{% endif %} {{ selected_year }}
    </p>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 25px 0;">
        <div style="background: #e1f5fe; padding: 20px; border-radius: 20px; text-align: left;">
            <small style="color: #0288d1; font-weight: bold;">Income</small>
            <div style="font-size: 1.4rem; font-weight: 700;">+{{ total_month_income }} ‚Ç¥</div>
        </div>
        <div style="background: #fff0f3; padding: 20px; border-radius: 20px; text-align: left;">
            <small style="color: #d63031; font-weight: bold;">Expenses</small>
            <div style="font-size: 1.4rem; font-weight: 700;">-{{ total_month_expenses }} ‚Ç¥</div>
        </div>
    </div>

    <div style="background: #f8f9fa; padding: 15px; border-radius: 15px; margin-bottom: 30px; display: flex; justify-content: space-around; font-size: 0.9rem;">
        <div>Avg. Daily: <strong>{{ avg_daily|stringformat:".2f" }} ‚Ç¥</strong></div>
        <div>Balance: <strong style="color: {% if monthly_balance >= 0 %}var(--accent-green){% else %}var(--accent-red){% endif %};">{{ monthly_balance }} ‚Ç¥</strong></div>
    </div>

    {% if category_amounts %}
    <div style="max-width: 320px; margin: 0 auto 40px;">
        <canvas id="expenseChart"></canvas>
    </div>
    {% else %}
    <p style="padding: 40px; color: var(--text-muted);">No data for this month yet üï∏Ô∏è</p>
    {% endif %}

    <a href="{% url 'home' %}" class="back-link">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    {% if category_amounts %}
    const ctx = document.getElementById('expenseChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: {{ category_labels|safe }},
            datasets: [{
                data: {{ category_amounts|safe }},
                backgroundColor: [
                    '#0984e3', '#00b894', '#fdcb6e', '#d63031', '#6c5ce7', '#fab1a0', '#a29bfe'
                ],
                hoverOffset: 10,
                borderWidth: 4,
                borderColor: '#ffffff'
            }]
        },
        options: {
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { padding: 20, usePointStyle: true }
                }
            }
        }
    });
    {% endif %}
</script>
{% endblock %}